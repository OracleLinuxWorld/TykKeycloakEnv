############################ TYK ###########################
###
### TYK installation and configuration
###

- name: Add Tyk repo
  yum_repository:
    name: tyk_tyk-dashboard
    baseurl: https://packagecloud.io/tyk/tyk-dashboard/el/7/$basearch
    repo_gpgcheck: 1
    gpgcheck: 1
    gpgkey:
      - http://keyserver.tyk.io/tyk.io.rpm.signing.key
      - https://packagecloud.io/tyk/tyk-dashboard/gpgkey
    enabled: 1

- name: Add MongoDB repo
  yum_repository:
    name: MongoDB Repository
    baseurl: https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.0/x86_64/
    gpgcheck: 0
    enabled: 1

- name: Install prerequisites
  yum:
    name: "{{ item }}"
    state: present
    update_cache: yes
  with_items:
    - python34
    - mongodb-org
    - tyk-dashboard
    - redis

### Start sonarQube
- name: Enable mongo and redis services
  service:
    name: "{{ item }}"
    state: started
    enabled: yes
    daemon_reload: yes
  with_items:
    - mongod
    - redis
